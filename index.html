<html>

<head>
        <title>cw2</title>
        <script src="https://unpkg.com/vue"></script>
        <link href="style.css" rel="stylesheet" type="text/css" />


</head>

<body>
        <div id='app'>
                <span v-if='currentUser'>
                        {{currentUser}}

                        <button @click='signout'>Sign out</button>
                        <article v-for="course in courses">
                                        <img :src="'data/img/'+course.slug+'.jpg'" :alt="course.topic">
                                        <h3>{{course.name}}</h3>
                                        
                                        
                        </article>


                </span>
                <span v-else-if="provider">
                        <button @click='signout'>Sign out</button>
                        <div v-for='product in providerCourse' class='course'>
                                <ul>
                                        <li v-for='(value, key) in product'>
                                                {{key}}: {{value}}
                                        </li>
                                </ul>
                        </div>
                        <h1>Add Service</h1>

                        <form>
                                Topic:<input type="text" v-model="topic">
                                location:<input type="text" v-model="location">
                                price<input type="number" v-model="price">
                                Time<input type="time" v-model="time">


                        </form>
                        <button v-on:click="addService">add service</button>
                        <p>update course</p>
                        <p>please enter the ID of the course you wanna change</p>

                        <form >
                                ID:<input type='text' v-model="id">
                                Topic:<input type="text" v-model="newTopic">
                                location:<input type="text" v-model="newLocation">
                                price<input type="number" v-model="newPrice">
                                Time<input type="time" v-model="newTime">

                                <button v-on:click="update">update course</button>
                        </form>
                        <h3>delete course</h3>
                      Enter Id:  <input type ="text" v-model="deleteId">
                      <button v-on:click="deleteCourse">Delete course</button>




                      





                </span>



                <span v-else>
                        <form>

                                <label for="email">Email</label>
                                <input required type="email" v-model="email">
                                <label for="password">Password</label>
                                <input required type="password" v-model="password">
                                <input type="radio" id="option1" value="student" v-model="userType">
                                <label for="option1">student</label>
                                <input type="radio" id="option2" value="provider" v-model="userType">
                                <label for="option2">provider</label>





                                <button v-on:click='signup'>Sign up</button>
                        </form>

                        <button v-on:click='signin'>Sign in</button>
                        <button v-on:click='signout'>Sign out</button>

                        {{userMessage}}
                </span>

        </div>
        <script>
                var app = new Vue({
                        el: "#app",
                        data: {
                                currentUser: '',
                                email: '',
                                password: '',
                                userMessage: '',
                                userType: '',
                                courses: [],
                                users: [],
                                'term': '',
                                response: '',
                                provider: '',
                                topic: '',
                                location: '',
                                price: '',
                                time: '',
                                id: '',
                                newTopic: '',
                                newLocation: '',

                                newPrice: '',
                                newTime: '',
                                deleteId:''
                        },
                        methods: {
                                signup: function () {
                                        var data = { email: this.email, password: this.password, userType: this.userType }

                                        fetch('http://localhost:3000/collections/users', {
                                                method: 'post', // or 'PUT'
                                                headers: {
                                                        'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify(data),
                                        })
                                                .then((response) => response.json())
                                                .then((data) => {
                                                        console.log('Success:', data);
                                                        alert("registered")
                                                })
                                                .catch((error) => {
                                                        console.error('Error:', error);
                                                });
                                                 },

                                signin: function () {


                                        var newEmail = this.email;
                                        var newPassword = this.password;
                                        if (this.users.some(function (user) { return (user.email === newEmail && user.password === newPassword && user.userType === 'student') })) {
                                                alert("loggedin")
                                                this.currentUser = this.email
                                        }
                                        else if (this.users.some(function (user) { return (user.email === newEmail && user.password === newPassword && user.userType === 'provider') })) {
                                                alert('loggedin')
                                                this.provider = this.email;
                                        }
                                },

                                signout: function () {

                                        this.currentUser = '';
                                        this.email = '';
                                        this.password = '';
                                        this.provider = '';
                                },
                                addService: function () {
                                        var data = { topic: this.topic, location: this.location, price: this.price, time: this.time, email: this.email }

                                        fetch('http://localhost:3000/collections/courses', {
                                                method: 'POST', // or 'PUT'
                                                headers: {
                                                        'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify(data),
                                        })
                                                .then((response) => response.json())
                                                .then((data) => {
                                                        console.log('Success:', data);
                                                        alert("added")
                                                })
                                                .catch((error) => {
                                                        console.error('Error:', error);
                                                });

                                },
                                update: function () {
                                        var id = this.id;
                                        var data = { topic: this.newTopic, location: this.newLocation, price: this.newPrice, time: this.newTime }


                                        fetch(`http://localhost:3000/collections/courses/${id}`, {
                                                method: 'Put',
                                                headers: {
                                                        'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify(data),
                                        })
                                                .then((response) => response.json())
                                                .then((data) => {
                                                        console.log('Success:', data);
                                                        alert("updated")
                                                })
                                                .catch((error) => {
                                                        console.error('Error:', error);
                                                });
                                },
                                deleteCourse:function(){
                                        var deleteId=this.deleteId;
                                        fetch(`http://localhost:3000/collections/courses/${deleteId}`, {
                                                method: 'delete',
                                                headers: {
                                                        'Content-Type': 'application/json',
                                                },
                                             
                                        })
                                                .then((response) => response.json())
                                                .then((data) => {
                                                        console.log('Success:', data);
                                                        alert("updated")
                                                })
                                                .catch((error) => {
                                                        console.error('Error:', error);
                                                });
                                }

                                

                        }

                        ,
                        computed: {
                                results: function () {
                                        return this.courses.filter(course =>
                                                course.topic.includes(this.term)
                                        )
                                },
                                providerCourse: function () {
                                        newEmail = this.email
                                        return this.courses.filter(function (course) {
                                                if (course.email === newEmail) {
                                                        return course.topic
                                                }
                                        })

                                }

                        }
                })
                fetch('http://localhost:3000/collections/courses')

                        .then(response => {

                                return response.json();
                        })


                        .then(response => {
                                // alert(response);
                                app.courses = response;
                        }).catch(function (err) {
                                console.log('Fetch problem: ' + err.message);
                        })

                fetch('http://localhost:3000/collections/users')

                        .then(response => {

                                return response.json();
                        })


                        .then(response => {
                                // alert(response);
                                app.users = response;
                        }).catch(function (err) {
                                console.log('Fetch problem: ' + err.message);
                        })


        </script>





</html>